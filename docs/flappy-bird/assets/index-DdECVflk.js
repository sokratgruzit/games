(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class u{listeners={};on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){t?this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(s=>s!==t)):delete this.listeners[e]}emit(e,...t){if(this.listeners[e])for(const s of this.listeners[e])s(...t)}}class c{x;y;vy;weight;angle;width;height;canvasHeight;sprite;frames;currentFrame;scale;flapTimer=0;defaultFlyTimer=0;eventBus;constructor(e,t,s,i){this.x=150,this.canvasHeight=e,this.y=e/2,this.vy=0,this.angle=0,this.currentFrame=0,this.scale=s,this.weight=1,this.sprite=new Image,this.sprite.src=`assets/sprites/${t.meta.image}`,this.frames=Object.values(t.frames);const a=this.frames[0].frame;this.width=a.w*this.scale,this.height=a.h*this.scale,this.eventBus=i}update(e){const t=this.frames[this.currentFrame].frame;this.width=t.w*this.scale,this.height=t.h*this.scale;const s=15,i=this.canvasHeight-this.height-s*2,a=this.canvasHeight-this.height;if(e)this.vy-=2,this.y+=this.vy,this.vy*=.9,this.flap();else if(this.y>=i&&this.y<=a){this.defaultFlyTimer++;const h=i+s;this.y=h+Math.sin(this.defaultFlyTimer*.05)*s,this.defaultFlyTimer%15===0&&(this.currentFrame=(this.currentFrame+1)%this.frames.length)}else this.vy+=this.weight,this.y+=this.vy,this.vy*=.9,this.currentFrame=0,this.flapTimer=0,this.y+this.height>=this.canvasHeight&&this.eventBus.emit("birdCollision",this.x,this.y);this.y<0&&(this.y=0),this.y+this.height>this.canvasHeight&&(this.y=this.canvasHeight-this.height)}draw(e){const t=this.frames[this.currentFrame].frame;e.drawImage(this.sprite,t.x,t.y,t.w,t.h,this.x,this.y,t.w*this.scale,t.h*this.scale)}flap(){this.flapTimer++,this.flapTimer%3===0&&(this.currentFrame=(this.currentFrame+1)%this.frames.length)}}class n{sprite;frames;currentFrame;x;y;scale;active;frameTimer;frameDelay;eventBus;constructor(e,t,s,i=0){this.sprite=new Image,this.sprite.src=`assets/sprites/${e.meta.image}`,this.frames=Object.values(e.frames),this.currentFrame=0,this.scale=t,this.x=0,this.y=0,this.active=!1,this.frameTimer=0,this.frameDelay=i,this.eventBus=s,this.eventBus.on("explosionPlay",({x:a,y:h,index:d})=>{d!==void 0&&this.play(a,h)})}play(e,t){this.x=e,this.y=t,this.currentFrame=0,this.frameTimer=0,this.active=!0}update(){this.active&&(this.frameTimer++,this.frameTimer>=this.frameDelay&&(this.frameTimer=0,this.currentFrame++,this.currentFrame>=this.frames.length&&(this.active=!1,this.eventBus.emit("explosionFinished"))))}draw(e){if(!this.active)return;const t=this.frames[this.currentFrame].frame;e.drawImage(this.sprite,t.x,t.y,t.w,t.h,this.x,this.y,t.w*this.scale,t.h*this.scale)}isActive(){return this.active}}class m{canvasWidth;canvasHeight;layers;moon;constructor(e,t){this.canvasWidth=e,this.canvasHeight=t,this.layers=[{img:this.loadImage("assets/sprites/far-bg.png"),speedFactor:.05,x:0,y:-60},{img:this.loadImage("assets/sprites/middle-bg.png"),speedFactor:.1,x:0,y:-40},{img:this.loadImage("assets/sprites/near-bg.png"),speedFactor:.3,x:0,y:0}],this.moon={img:this.loadImage("assets/sprites/moon.png"),speedFactor:.05,x:this.canvasWidth,y:30,width:80,height:80}}loadImage(e){const t=new Image;return t.src=e,t}update(e){for(let t of this.layers)t.x-=e*t.speedFactor,t.x<=-this.canvasWidth&&(t.x=0);this.moon.x-=e*this.moon.speedFactor,this.moon.x+this.moon.width<=0&&(this.moon.x=this.canvasWidth)}draw(e){this.drawGradient(e);for(let t of this.layers)e.drawImage(t.img,t.x,t.y,this.canvasWidth,this.canvasHeight),e.drawImage(t.img,t.x+this.canvasWidth,t.y,this.canvasWidth,this.canvasHeight);e.drawImage(this.moon.img,this.moon.x,this.moon.y,this.moon.width,this.moon.height)}drawGradient(e){const t=e.createLinearGradient(0,0,0,this.canvasHeight);t.addColorStop(0,"rgba(200, 0, 0, 0.7)"),t.addColorStop(.5,"rgba(255, 100, 50, 0.4)"),t.addColorStop(1,"rgba(255, 200, 150, 0.2)"),e.fillStyle=t,e.fillRect(0,0,this.canvasWidth,this.canvasHeight)}}class p{update;render;raf;timeStep;accumulated;current;running;constructor(e,t){this.update=e,this.render=t,this.timeStep=1e3/60,this.accumulated=0,this.current=0,this.running=!1,this.raf=void 0}loop=e=>{let t=!1;const s=e-this.current;for(this.accumulated+=s,this.current=e,this.accumulated>1e3&&(this.accumulated=this.timeStep);this.accumulated>=this.timeStep;)this.update(this.timeStep),this.accumulated-=this.timeStep,t=!0;t&&this.render(),this.raf=window.requestAnimationFrame(this.loop)};start(){this.running||(this.running=!0,this.current=performance.now(),this.raf=window.requestAnimationFrame(this.loop))}stop(){this.running=!1,this.raf&&window.cancelAnimationFrame(this.raf)}setUp(e,t){this.update=e,this.render=t}}class f{x;y;size;speedY;color;gameSpeed;constructor(e,t,s,i){this.x=e,this.y=t+20,this.size=Math.random()*7+3,this.speedY=Math.random()*1-.5,this.color=s,this.gameSpeed=i}update(){this.x-=this.gameSpeed,this.y+=this.speedY}draw(e){e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.size,0,Math.PI*2),e.fill()}setGameSpeed(e){this.gameSpeed=e}}class g{particles=[];gameSpeed=2;update(e,t){this.particles.unshift(new f(e.x,e.y,t,this.gameSpeed));for(let s of this.particles)s.update();this.particles.length>200&&(this.particles.length=200)}draw(e){for(let t of this.particles)t.draw(e)}setGameSpeed(e){this.gameSpeed=e}clear(){this.particles.length=0}}class x{top;bottom;x;width;color;gameSpeed;counted;canvasWidth;canvasHeight;eventBus;constructor(e,t,s,i){this.top=Math.random()*t/3+20,this.bottom=Math.random()*t/3+20,this.x=e,this.width=20,this.color=s,this.gameSpeed=0,this.canvasWidth=e,this.canvasHeight=t,this.counted=!1,this.eventBus=i}update(){this.x-=this.gameSpeed,!this.counted&&this.eventBus&&this.x+this.width<150&&(this.counted=!0,this.eventBus.emit("scoreIncrease"))}draw(e){e.fillStyle=this.color,e.fillRect(this.x,0,this.width,this.top),e.fillRect(this.x,this.canvasHeight-this.bottom,this.width,this.bottom)}setGameSpeed(e){this.gameSpeed=e}setCounted(e){this.counted=e}}class w{obstacles=[];gameSpeed=2;eventBus;constructor(e){this.eventBus=e}updateAndGenerate(e,t,s,i){if(i%300===0){const a=new x(e,t,s,this.eventBus);a.setGameSpeed(this.gameSpeed),this.obstacles.unshift(a)}for(const a of this.obstacles)a.update();this.obstacles.length>20&&(this.obstacles.length=20)}draw(e){for(const t of this.obstacles)t.draw(e)}setGameSpeed(e){this.gameSpeed=e;for(const t of this.obstacles)t.setGameSpeed(e)}clear(){this.obstacles.length=0}}class y{keysPressed={};keysJustPressed={};constructor(){window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e))}onKeyDown(e){this.keysPressed[e.code]||(this.keysJustPressed[e.code]=!0),this.keysPressed[e.code]=!0}onKeyUp(e){this.keysPressed[e.code]=!1,this.keysJustPressed[e.code]=!1}isPressed(e){return!!this.keysPressed[e]}wasJustPressed(e){return this.keysJustPressed[e]?(this.keysJustPressed[e]=!1,!0):!1}}class v{checkCollision(e,t){for(const s of t){const i=e.x<s.x+s.width&&e.x+e.width>s.x&&e.y<s.top,a=e.x<s.x+s.width&&e.x+e.width>s.x&&e.y+e.height>s.canvasHeight-s.bottom;if(i||a)return!0}return!1}}class S{sounds={};eventBus;constructor(e){this.eventBus=e,this.load("explosion","assets/sounds/explosion.mp3"),this.load("point","assets/sounds/coin.mp3"),this.load("gamestart","assets/sounds/gamestart.wav"),this.load("gameover","assets/sounds/gameover.wav"),this.load("particles","assets/sounds/particles.mp3"),this.load("wings","assets/sounds/wings.mp3"),this.eventBus.on("birdCollision",()=>{this.play("explosion"),this.stop("particles"),this.play("gameover")}),this.eventBus.on("birdFlap",()=>{this.play("wings")}),this.eventBus.on("scoreIncrease",()=>{this.play("point")}),this.eventBus.on("gameStart",()=>{this.play("gamestart"),this.play("particles",!0)}),this.eventBus.on("gameOver",()=>{this.stop("particles")})}load(e,t){const s=new Audio(t);s.preload="auto",this.sounds[e]=s}play(e,t=!1){const s=this.sounds[e];s&&(s.currentTime=0,s.loop=t,s.play().catch(()=>{}))}stop(e){const t=this.sounds[e];t&&(t.pause(),t.currentTime=0)}}class b{ctx;width;height;score=0;paused=!1;gameOver=!1;constructor(e,t,s,i){this.ctx=e,this.width=t,this.height=s,i.on("scoreIncrease",()=>{this.score++}),i.on("pauseToggled",()=>{this.paused=!this.paused}),i.on("restartGame",()=>{this.reset()}),i.on("gameOver",()=>{this.gameOver=!0})}reset(){this.score=0,this.paused=!1,this.gameOver=!1}render(){this.drawScore(),this.paused&&!this.gameOver&&this.drawPauseText(),this.gameOver&&this.drawGameOverText()}drawScore(){this.ctx.save(),this.ctx.font="bold 24px sans-serif",this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=4;const e=`Score: ${this.score}`;this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.strokeText(e,this.width-20,20),this.ctx.fillText(e,this.width-20,20),this.ctx.restore()}drawPauseText(){this.ctx.save(),this.ctx.font="bold 64px sans-serif",this.ctx.fillStyle="yellow",this.ctx.strokeStyle="black",this.ctx.lineWidth=6;const e="Paused",t=this.width/2,s=this.height/2;this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeText(e,t,s),this.ctx.fillText(e,t,s),this.ctx.restore()}drawGameOverText(){this.ctx.save(),this.ctx.font="bold 64px sans-serif",this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=6;const e="Game Over",t=this.width/2,s=this.height/2;this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeText(e,t,s),this.ctx.fillText(e,t,s),this.ctx.restore()}}const B={"frame-1.png":{frame:{x:1,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-2.png":{frame:{x:942,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-3.png":{frame:{x:1883,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-4.png":{frame:{x:2824,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}}},M={app:"http://www.codeandweb.com/texturepacker",version:"1.0",image:"dragon.png",format:"RGBA8888",size:{w:3764,h:680},scale:"1"},l={frames:B,meta:M},P={"0.png":{frame:{x:1,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"1.png":{frame:{x:103,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"2.png":{frame:{x:205,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"3.png":{frame:{x:307,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"4.png":{frame:{x:409,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"5.png":{frame:{x:511,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"6.png":{frame:{x:613,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"7.png":{frame:{x:715,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}}},F={app:"http://www.codeandweb.com/texturepacker",version:"1.0",image:"explosion.png",format:"RGBA8888",size:{w:816,h:102},scale:"1"},o={frames:P,meta:F};class O{ctx;bird;explosions;currentExplosionIndex;background;gameOver;paused;engine;width;height;hue;frame;score;particleManager;obstacleManager;inputManager;collisionManager;particlePlaying;eventBus;uiManager;soundManager;gameSpeed;constructor(e,t,s){this.ctx=e,this.width=t,this.height=s,this.hue=0,this.frame=0,this.gameSpeed=2,this.paused=!1,this.score=0,this.gameOver=!1,this.currentExplosionIndex=0,this.particlePlaying=!1,this.eventBus=new u,this.bird=new c(s,l,.1,this.eventBus),this.particleManager=new g,this.obstacleManager=new w(this.eventBus),this.background=new m(t,s),this.inputManager=new y,this.collisionManager=new v,this.soundManager=new S(this.eventBus),this.uiManager=new b(this.ctx,this.width,this.height,this.eventBus),this.explosions=[new n(o,1,this.eventBus),new n(o,1.5,this.eventBus),new n(o,2,this.eventBus)],this.eventBus.on("birdCollision",(i,a)=>{this.gameOver=!0,this.currentExplosionIndex=0,this.eventBus.emit("explosionPlay",{x:i,y:a,index:0}),this.stopParticleSound()}),this.eventBus.on("explosionFinished",()=>{this.currentExplosionIndex++,this.currentExplosionIndex<this.explosions.length&&this.eventBus.emit("explosionPlay",{x:this.bird.x,y:this.bird.y,index:this.currentExplosionIndex})}),this.eventBus.on("pauseToggled",()=>{this.paused=!this.paused}),this.eventBus.on("restartGame",()=>{this.restartGame()}),this.eventBus.on("gameOver",()=>{this.gameOver=!0}),this.eventBus.on("scoreIncrease",()=>{this.score++,this.soundManager.play("particles")}),this.engine=new p(this.update,this.render)}start(){this.engine.start(),this.eventBus.emit("gameStart")}stop(){this.engine.stop()}restartGame(){this.eventBus.emit("gameStart"),this.bird=new c(this.height,l,.1,this.eventBus),this.particleManager.clear(),this.obstacleManager.clear(),this.hue=0,this.frame=0,this.gameOver=!1,this.paused=!1,this.currentExplosionIndex=0,this.explosions.forEach(e=>e.update()),this.score=0,this.particlePlaying=!0}update=e=>{if(this.inputManager.wasJustPressed("KeyP")&&this.eventBus.emit("pauseToggled"),this.inputManager.wasJustPressed("KeyR")&&this.eventBus.emit("restartGame"),!this.paused){if(this.gameOver&&this.currentExplosionIndex>=this.explosions.length){this.eventBus.emit("gameOver");return}this.gameOver||(this.bird.update(this.inputManager.isPressed("Space")),this.inputManager.isPressed("Space")&&this.eventBus.emit("birdFlap")),this.particleManager.setGameSpeed(this.gameSpeed),this.particleManager.update(this.bird,`hsla(${this.hue}, 100%, 50%, 0.8)`),this.obstacleManager.setGameSpeed(this.gameSpeed),this.obstacleManager.updateAndGenerate(this.width,this.height,`hsla(${this.hue}, 100%, 50%, 0.8)`,this.frame),this.background.update(this.gameSpeed),!this.gameOver&&this.collisionManager.checkCollision(this.bird,this.obstacleManager.obstacles)&&this.eventBus.emit("birdCollision",this.bird.x,this.bird.y),this.explosions.forEach(t=>t.update()),this.hue++,this.frame++}};render=()=>{this.ctx.clearRect(0,0,this.width,this.height),this.background.draw(this.ctx),this.obstacleManager.draw(this.ctx),this.gameOver||this.particleManager.draw(this.ctx),this.gameOver||this.bird.draw(this.ctx),this.explosions.forEach(e=>e.draw(this.ctx)),this.uiManager.render()};stopParticleSound(){this.particlePlaying&&(this.particlePlaying=!1)}}document.querySelector("#app").innerHTML=`
  <canvas id="canvas" />
`;window.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("canvas"),e=r.getContext("2d");r.width=600,r.height=400,new O(e,r.width,r.height).start()});
