(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class T{flapTimer=0;defaultFlyTimer=0}class M{keys={}}class y{x;y;constructor(t,e){this.x=t,this.y=e}}class z{sprite;frames;currentFrame;scale;width;height;constructor(t,e,s){this.sprite=new Image,this.sprite.src=t,this.frames=e,this.currentFrame=0,this.scale=s;const i=e[0].frame;this.width=i.w*s,this.height=i.h*s}}class w{vx;vy;constructor(t,e){this.vx=t,this.vy=e}}class v{width;height;constructor(t,e){this.width=t,this.height=e}}class O{top;bottom;counted;constructor(t,e){this.top=t,this.bottom=e,this.counted=!1}}class I{color;constructor(t){this.color=t}}class G{angle;weight;constructor(t,e=1){this.angle=t,this.weight=e}}class P{canvasHeight;canvasWidth;constructor(t,e){this.canvasWidth=t,this.canvasHeight=e}}class L{paused=!1;gameOver=!1;score=0;currentExplosionIndex=0;hue=0;frame=0;particlePlaying=!0}class H{scale;constructor(t){this.scale=t}}class R{active=!1;frameTimer=0;frameDelay=2}class W{update(t,e,s){s.keys.Space?(e.flapTimer++,e.flapTimer%3===0&&(t.currentFrame=(t.currentFrame+1)%t.frames.length)):s.keys.Space||e.defaultFlyTimer%15===0&&(t.currentFrame=(t.currentFrame+1)%t.frames.length)}}class g{id;components;constructor(t){this.id=t,this.components=new Map}addComponent(t,e){return this.components.set(t,e),this}getComponent(t){return this.components.get(t)}hasComponent(t){return this.components.has(t)}}class A{listeners={};on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}off(t,e){e?this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(s=>s!==e)):delete this.listeners[t]}emit(t,...e){if(this.listeners[t])for(const s of this.listeners[t])s(...e)}}class K{eventBus;canvasHeight;constructor(t,e){this.eventBus=t,this.canvasHeight=e}collisions(t,e){const s=t.getComponent("position"),i=t.getComponent("size");if(!(!s||!i))for(const n of e){const a=n.getComponent("position"),r=n.getComponent("size"),h=n.getComponent("obstacle");if(!a||!r||!h)continue;const c=s.x,d=s.x+i.width,p=s.y,m=s.y+i.height,l=a.x,u=a.x+r.width,C=h.top,S=this.canvasHeight-h.bottom;if(d>l&&c<u&&p<C){this.eventBus.emit("birdCollision",s.x,s.y);return}if(d>l&&c<u&&m>S){this.eventBus.emit("birdCollision",s.x,s.y);return}}}}class J{update(t,e,s){for(const i of t){const n=i.getComponent("position"),a=i.getComponent("velocity"),r=i.getComponent("explosion"),h=i.getComponent("sprite");if(console.log(r,h,n),r&&h&&n){if(!r.active)continue;r.active&&(r.frameTimer++,r.frameTimer>=r.frameDelay&&(r.frameTimer=0,h.currentFrame++,h.currentFrame>=h.frames.length&&(r.active=!1,e.emit("explosionFinished"))))}if(!n||!a)continue;const c=i.getComponent("boundary"),d=i.getComponent("physics"),p=i.getComponent("bird"),m=i.getComponent("input"),l=i.getComponent("size");if(p&&m&&l&&c&&d&&h){const b=c.canvasHeight-l.height-30,k=c.canvasHeight;if(m.keys.Space)a.vy-=2,n.y+=a.vy,a.vy*=.9;else if(n.y>=b&&n.y<=k){p.defaultFlyTimer++;const F=b+15;n.y=F+Math.sin(p.defaultFlyTimer*.05)*15}else a.vy+=d.weight,n.y+=a.vy,h.currentFrame=0,p.flapTimer=0,a.vy*=.9;n.y<0&&(n.y=0),n.y+l.height>c.canvasHeight&&(n.y=c.canvasHeight-l.height);continue}const u=i.getComponent("obstacle");if(u&&l){n.x-=a.vx,!u.counted&&e&&n.x+l.width<150&&(e.emit("scoreIncrease"),u.counted=!0);continue}i.getComponent("scale")&&(n.x-=a.vx,n.y+=a.vy)}}}class ${ctx;constructor(t){this.ctx=t}render(t){for(const e of t){const s=e.getComponent("position"),i=e.getComponent("color"),n=e.getComponent("explosion");if(!s)continue;const a=e.getComponent("sprite");if(a){if(n&&!n.active)continue;const p=a.currentFrame,m=a.frames[p].frame;this.ctx.drawImage(a.sprite,m.x,m.y,m.w,m.h,s.x,s.y,m.w*a.scale,m.h*a.scale);continue}const r=e.getComponent("obstacle"),h=e.getComponent("size"),c=e.getComponent("boundary");r&&h&&i&&c&&(this.ctx.fillStyle=i.color,this.ctx.fillRect(s.x,0,h.width,r.top),this.ctx.fillRect(s.x,c.canvasHeight-r.bottom,h.width,r.bottom));const d=e.getComponent("scale");d&&i&&(this.ctx.fillStyle=i.color,this.ctx.beginPath(),this.ctx.arc(s.x,s.y,d.scale,0,Math.PI*2),this.ctx.fill())}}}class D{keysPressed={};keysJustPressed={};constructor(){window.addEventListener("keydown",t=>this.onKeyDown(t)),window.addEventListener("keyup",t=>this.onKeyUp(t))}onKeyDown(t){this.keysPressed[t.code]||(this.keysJustPressed[t.code]=!0),this.keysPressed[t.code]=!0}onKeyUp(t){this.keysPressed[t.code]=!1,this.keysJustPressed[t.code]=!1}isPressed(t){return!!this.keysPressed[t]}wasJustPressed(t){return this.keysJustPressed[t]?(this.keysJustPressed[t]=!1,!0):!1}}class q{inputManager;constructor(t){this.inputManager=t}update(t,e){e==="bird"&&(t.keys.Space=this.inputManager.isPressed("Space")),e==="game"&&(t.keys.KeyP=this.inputManager.wasJustPressed("KeyP"),t.keys.KeyR=this.inputManager.wasJustPressed("KeyR"))}}class U{game;input;eventBus;constructor(t,e){this.game=t.getComponent("game"),this.input=t.getComponent("input"),this.eventBus=e,this.registerEventListeners()}registerEventListeners(){this.eventBus.on("birdCollision",()=>{this.game.gameOver=!0,this.game.currentExplosionIndex=0,this.game.particlePlaying=!1}),this.eventBus.on("explosionFinished",()=>{this.game.currentExplosionIndex++}),this.eventBus.on("restartGame",()=>{this.resetGame()}),this.eventBus.on("gameOver",()=>{this.game.gameOver=!0}),this.eventBus.on("scoreIncrease",()=>{this.game.score++})}resetGame(){this.game.score=0,this.game.gameOver=!1,this.game.paused=!1,this.game.hue=0,this.game.frame=0,this.game.currentExplosionIndex=0,this.game.particlePlaying=!0}update(){this.input.keys.KeyP&&(this.eventBus.emit("pauseToggled"),this.game.paused=!this.game.paused),this.input.keys.KeyR&&this.eventBus.emit("restartGame"),this.game.hue++,this.game.frame++}}function B(o,t,e,s,i){const n=new g(o),a=new M,r=new y(150,e/2),h=new w(0,0),c=new T,d=new G(0,1),p=new P(t,e),m=new z(`assets/sprites/${s.meta.image}`,Object.values(s.frames),i),l=new v(m.width,m.height);return n.addComponent("position",r).addComponent("input",a).addComponent("velocity",h).addComponent("bird",c).addComponent("sprite",m).addComponent("size",l).addComponent("boundary",p).addComponent("physics",d),n}function j(o,t,e,s,i=20){const n=new g(o),a=Math.random()*e/3+20,r=Math.random()*e/3+20,h=new y(t,0),c=new v(i,a+r),d=new O(a,r),p=new I(s),m=new w(2,0),l=new P(t,e);return n.addComponent("position",h).addComponent("size",c).addComponent("obstacle",d).addComponent("color",p).addComponent("velocity",m).addComponent("boundary",l),n}function N(o){const t=new g(o),e=new L,s=new M;return t.addComponent("game",e).addComponent("input",s),t}function V(o,t,e,s){const i=new g(o),n=new y(t,e+20),a=new I(s),r=new w(2,Math.random()*1-.5),h=new H(Math.random()*7+3);return i.addComponent("position",n).addComponent("scale",h).addComponent("color",a).addComponent("velocity",r),i}function f(o,t,e,s,i){const n=new g(o),a=new y(t,e),r=new R,h=new z(`assets/sprites/${s.meta.image}`,Object.values(s.frames),i),c=new v(h.width,h.height);return n.addComponent("position",a).addComponent("explosion",r).addComponent("sprite",h).addComponent("size",c),n}class Y{canvasWidth;canvasHeight;layers;moon;constructor(t,e){this.canvasWidth=t,this.canvasHeight=e,this.layers=[{img:this.loadImage("assets/sprites/far-bg.png"),speedFactor:.05,x:0,y:-60},{img:this.loadImage("assets/sprites/middle-bg.png"),speedFactor:.1,x:0,y:-40},{img:this.loadImage("assets/sprites/near-bg.png"),speedFactor:.3,x:0,y:0}],this.moon={img:this.loadImage("assets/sprites/moon.png"),speedFactor:.05,x:this.canvasWidth,y:30,width:80,height:80}}loadImage(t){const e=new Image;return e.src=t,e}update(t){for(let e of this.layers)e.x-=t*e.speedFactor,e.x<=-this.canvasWidth&&(e.x=0);this.moon.x-=t*this.moon.speedFactor,this.moon.x+this.moon.width<=0&&(this.moon.x=this.canvasWidth)}draw(t){this.drawGradient(t);for(let e of this.layers)t.drawImage(e.img,e.x,e.y,this.canvasWidth,this.canvasHeight),t.drawImage(e.img,e.x+this.canvasWidth,e.y,this.canvasWidth,this.canvasHeight);t.drawImage(this.moon.img,this.moon.x,this.moon.y,this.moon.width,this.moon.height)}drawGradient(t){const e=t.createLinearGradient(0,0,0,this.canvasHeight);e.addColorStop(0,"rgba(200, 0, 0, 0.7)"),e.addColorStop(.5,"rgba(255, 100, 50, 0.4)"),e.addColorStop(1,"rgba(255, 200, 150, 0.2)"),t.fillStyle=e,t.fillRect(0,0,this.canvasWidth,this.canvasHeight)}}class _{update;render;raf;timeStep;accumulated;current;running;constructor(t,e){this.update=t,this.render=e,this.timeStep=1e3/60,this.accumulated=0,this.current=0,this.running=!1,this.raf=void 0}loop=t=>{let e=!1;const s=t-this.current;for(this.accumulated+=s,this.current=t,this.accumulated>1e3&&(this.accumulated=this.timeStep);this.accumulated>=this.timeStep;)this.update(this.timeStep),this.accumulated-=this.timeStep,e=!0;e&&this.render(),this.raf=window.requestAnimationFrame(this.loop)};start(){this.running||(this.running=!0,this.current=performance.now(),this.raf=window.requestAnimationFrame(this.loop))}stop(){this.running=!1,this.raf&&window.cancelAnimationFrame(this.raf)}setUp(t,e){this.update=t,this.render=e}}class Q{entities=[];idCounter=1;generate(t,e,s){const i=V(this.idCounter++,t,e,s);this.entities.unshift(i),this.entities.length>200&&(this.entities.length=200)}clear(){this.entities.length=0}}class X{entities=[];idCounter=1;generate(t,e,s,i){if(i%300===0){const n=j(this.idCounter++,t,e,s);this.entities.push(n)}this.entities.length>20&&(this.entities.length=20)}clear(){this.entities.length=0}}class Z{sounds={};eventBus;constructor(t){this.eventBus=t,this.load("explosion","assets/sounds/explosion.mp3"),this.load("point","assets/sounds/coin.mp3"),this.load("gamestart","assets/sounds/gamestart.wav"),this.load("gameover","assets/sounds/gameover.wav"),this.load("particles","assets/sounds/particles.mp3"),this.load("wings","assets/sounds/wings.mp3"),this.eventBus.on("birdCollision",()=>{this.play("explosion"),this.stop("particles"),this.play("gameover")}),this.eventBus.on("birdFlap",()=>{this.play("wings")}),this.eventBus.on("scoreIncrease",()=>{this.play("point")}),this.eventBus.on("gameStart",()=>{this.play("gamestart"),this.play("particles",!0)}),this.eventBus.on("gameOver",()=>{this.stop("particles")})}load(t,e){const s=new Audio(e);s.preload="auto",this.sounds[t]=s}play(t,e=!1){const s=this.sounds[t];s&&(s.currentTime=0,s.loop=e,s.play().catch(()=>{}))}stop(t){const e=this.sounds[t];e&&(e.pause(),e.currentTime=0)}}class tt{ctx;width;height;gameState;constructor(t,e,s,i){this.ctx=t,this.width=e,this.height=s,this.gameState=i}render(){const t=this.gameState.getComponent("game");this.drawScore(t?.score||0),t?.paused&&!t?.gameOver&&this.drawPauseText(),t?.gameOver&&this.drawGameOverText()}drawScore(t){this.ctx.save(),this.ctx.font="bold 24px sans-serif",this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=4;const e=`Score: ${t}`;this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.strokeText(e,this.width-20,20),this.ctx.fillText(e,this.width-20,20),this.ctx.restore()}drawPauseText(){this.ctx.save(),this.ctx.font="bold 64px sans-serif",this.ctx.fillStyle="yellow",this.ctx.strokeStyle="black",this.ctx.lineWidth=6;const t="Paused",e=this.width/2,s=this.height/2;this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeText(t,e,s),this.ctx.fillText(t,e,s),this.ctx.restore()}drawGameOverText(){this.ctx.save(),this.ctx.font="bold 64px sans-serif",this.ctx.fillStyle="white",this.ctx.strokeStyle="black",this.ctx.lineWidth=6;const t="Game Over",e=this.width/2,s=this.height/2;this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeText(t,e,s),this.ctx.fillText(t,e,s),this.ctx.restore()}}const et={"frame-1.png":{frame:{x:1,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-2.png":{frame:{x:942,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-3.png":{frame:{x:1883,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}},"frame-4.png":{frame:{x:2824,y:1,w:939,h:678},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:939,h:678},sourceSize:{w:939,h:678}}},st={app:"http://www.codeandweb.com/texturepacker",version:"1.0",image:"dragon.png",format:"RGBA8888",size:{w:3764,h:680},scale:"1"},E={frames:et,meta:st},it={"0.png":{frame:{x:1,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"1.png":{frame:{x:103,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"2.png":{frame:{x:205,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"3.png":{frame:{x:307,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"4.png":{frame:{x:409,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"5.png":{frame:{x:511,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"6.png":{frame:{x:613,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}},"7.png":{frame:{x:715,y:1,w:100,h:100},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:100,h:100},sourceSize:{w:100,h:100}}},nt={app:"http://www.codeandweb.com/texturepacker",version:"1.0",image:"explosion.png",format:"RGBA8888",size:{w:816,h:102},scale:"1"},x={frames:it,meta:nt};class ot{ctx;explosions;background;engine;width;height;particleManager;obstacleManager;inputManager;eventBus;uiManager;soundManager;gameSpeed;entityIdCounter=1;physicsSystem;renderSystem;collisionSystem;animationSystem;inputSystem;gameSystem;birdEntity;gameEntity;constructor(t,e,s){this.ctx=t,this.width=e,this.height=s,this.gameSpeed=2,this.gameEntity=N(this.entityIdCounter++),this.birdEntity=B(this.entityIdCounter++,e,s,E,.1),this.eventBus=new A,this.physicsSystem=new J,this.renderSystem=new $(this.ctx),this.collisionSystem=new K(this.eventBus,this.height),this.animationSystem=new W,this.inputManager=new D,this.inputSystem=new q(this.inputManager),this.gameSystem=new U(this.gameEntity,this.eventBus),this.particleManager=new Q,this.obstacleManager=new X,this.background=new Y(e,s),this.soundManager=new Z(this.eventBus),this.uiManager=new tt(this.ctx,this.width,this.height,this.gameEntity),this.explosions=[],this.eventBus.on("birdCollision",(i,n)=>{const a=f(this.entityIdCounter++,i,n,x,1),r=f(this.entityIdCounter++,i,n,x,1.5),h=f(this.entityIdCounter++,i,n,x,2);this.explosions.push(a),this.explosions.push(r),this.explosions.push(h),this.eventBus.emit("explosionPlay",{x:i,y:n,index:0})}),this.eventBus.on("explosionFinished",()=>{const i=this.gameEntity.getComponent("game");if(console.log(i?.currentExplosionIndex),i&&i.currentExplosionIndex<this.explosions.length){const n=this.birdEntity.getComponent("position");n&&this.eventBus.emit("explosionPlay",{x:n.x,y:n.y,index:i.currentExplosionIndex})}}),this.eventBus.on("restartGame",()=>{this.restartGame()}),this.eventBus.on("scoreIncrease",()=>{this.soundManager.play("particles")}),this.engine=new _(this.update,this.render)}start(){this.engine.start(),this.eventBus.emit("gameStart")}stop(){this.engine.stop()}restartGame(){this.eventBus.emit("gameStart"),this.birdEntity=B(this.entityIdCounter++,this.width,this.height,E,.1),this.particleManager.clear(),this.obstacleManager.clear()}update=t=>{const e=this.birdEntity.getComponent("input"),s=this.gameEntity.getComponent("input"),i=this.gameEntity.getComponent("game");if(e&&this.inputSystem.update(e,"bird"),s&&this.inputSystem.update(s,"game"),this.gameSystem.update(),i?.paused)return;if(i?.gameOver&&i?.currentExplosionIndex>=this.explosions.length){this.eventBus.emit("gameOver");return}if(!i?.gameOver){const a=this.birdEntity.getComponent("sprite"),r=this.birdEntity.getComponent("bird"),h=this.birdEntity.getComponent("input");a&&r&&h&&this.animationSystem.update(a,r,h),this.physicsSystem.update([this.birdEntity,...this.obstacleManager.entities,...this.particleManager.entities,...this.explosions],this.eventBus,t),this.collisionSystem.collisions(this.birdEntity,this.obstacleManager.entities)}const n=this.birdEntity.getComponent("position");n&&this.particleManager.generate(n.x,n.y,`hsla(${i?.hue}, 100%, 50%, 0.8)`),this.obstacleManager.generate(this.width,this.height,`hsla(${i?.hue}, 100%, 50%, 0.8)`,i?.frame||0),this.background.update(this.gameSpeed)};render=()=>{this.ctx.clearRect(0,0,this.width,this.height),this.background.draw(this.ctx);const t=this.gameEntity.getComponent("game");let e=[];t?.gameOver||(e=[this.birdEntity,...this.obstacleManager.entities,...this.particleManager.entities]),this.renderSystem.render(e.concat(this.explosions)),this.uiManager.render()}}document.querySelector("#app").innerHTML=`
  <canvas id="canvas" />
`;window.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("canvas"),t=o.getContext("2d");o.width=600,o.height=400,new ot(t,o.width,o.height).start()});
