(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const n=480,o=480,_=1,T=.8,b=32,S=32,O=0,A=100,f={top:o-S};class y{old_y;x;y;width;height;constructor(t,e,s,i){this.old_y=e,this.x=t,this.y=e,this.width=s,this.height=i}getBottom(){return this.y+this.height}getTop(){return this.y}getOldBottom(){return this.old_y+this.height}getOldTop(){return this.old_y}getLeft(){return this.x}getRight(){return this.x+this.width}setBottom(t){this.y=t-this.height}setTop(t){this.y=t}setLeft(t){this.x=t}setRight(t){this.x=t-this.width}moveX(t){this.x+=t}moveY(t){this.old_y=this.y,this.y+=t}getCenterX(){return this.x+this.width*.5}getCenterY(){return this.y+this.height*.5}}class p{frames;currentFrame;frameDuration;lastUpdate;constructor(t,e){this.frames=t,this.currentFrame=0,this.frameDuration=1e3/e,this.lastUpdate=performance.now()}update(){const t=performance.now();t-this.lastUpdate>=this.frameDuration&&(this.currentFrame=(this.currentFrame+1)%this.frames.length,this.lastUpdate=t)}render(t,e,s,i,r){const a=this.frames[this.currentFrame],l=i??a.width,c=r??a.height;t.drawImage(a.image,e,s,l,c)}}class E extends y{color;velocity_x;velocity_y;move_force;jump_force;grounded;idleSprite;runSprite;jumpSprite;slideSprite;sprite;sliding=!1;slideDirection=0;slideTimer=0;slideDuration=20;constructor(t,e,s,i,r,a,l,c,m){super(t,e,s,i),this.color=r,this.velocity_x=0,this.velocity_y=0,this.move_force=1,this.jump_force=16,this.grounded=!1,this.idleSprite=a,this.runSprite=l,this.jumpSprite=c,this.slideSprite=m,this.sprite=a}ground(){this.grounded=!0,this.velocity_y=0}jump(){this.grounded&&(this.grounded=!1,this.velocity_y-=this.jump_force,this.sprite=this.jumpSprite)}moveLeft(){this.velocity_x-=this.move_force}moveRight(){this.velocity_x+=this.move_force}slide(t){this.grounded&&(this.sliding=!0,this.slideDirection=t,this.slideTimer=this.slideDuration,this.velocity_x=5*t,this.sprite=this.slideSprite)}updatePosition(t,e){this.old_y=this.y,this.velocity_y+=t,this.moveY(this.velocity_y),this.x+=this.velocity_x,this.x<-this.width&&(this.x=n+this.width),this.x>n+this.width&&(this.x=-this.width),this.sliding?(this.slideTimer--,this.slideTimer<=0&&(this.sliding=!1)):this.velocity_x*=e,this.grounded?this.sliding?this.sprite=this.slideSprite:Math.abs(this.velocity_x)>.1?this.sprite=this.runSprite:this.sprite=this.idleSprite:this.sprite=this.jumpSprite,this.sprite.update()}render(t){const e=this.velocity_x<0,s=this.width,i=this.height;t.save(),e?(t.translate(this.x+s,this.y),t.scale(-1,1),this.sprite.render(t,0,0,s,i)):this.sprite.render(t,this.x,this.y,s,i),t.restore()}}class L{left;right;up;down;pause;start;gameOver;pauseElement=null;constructor(t,e,s,i,r,a){this.left=t,this.right=e,this.up=s,this.pause=i,this.down=r,this.start=a,this.gameOver=!1}showPauseOverlay(){this.pauseElement||(this.pauseElement=document.createElement("div"),this.pauseElement.innerText="PAUSED",Object.assign(this.pauseElement.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"48px",color:"white",pointerEvents:"none",zIndex:"1000"}),document.body.appendChild(this.pauseElement))}removePauseOverlay(){this.pauseElement&&(this.pauseElement.remove(),this.pauseElement=null)}keyDown=t=>{switch(t.key){case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break;case"ArrowUp":this.up=!0;break;case"ArrowDown":this.down=!0;break;case"Enter":this.gameOver&&(this.start=!0);break;case" ":this.gameOver||(this.pause=!this.pause),this.pause?this.showPauseOverlay():this.removePauseOverlay();break}};getGameOver=t=>{this.gameOver=t};keyUp=t=>{switch(t.key){case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break;case"ArrowUp":this.up=!1;break;case"ArrowDown":this.down=!1;break}};activate(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp)}deactivate(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp)}}class Y{update;render;raf;timeStep;accumulated;current;elapsed;running;constructor(t,e){this.update=t,this.render=e,this.timeStep=1e3/60,this.accumulated=0,this.current=0,this.elapsed=0,this.running=!1,this.raf=void 0}loop=t=>{let e=!1;for(this.elapsed=t-this.current,this.accumulated+=this.elapsed,this.current=t,this.accumulated>60&&(this.accumulated=this.timeStep);this.accumulated>=this.timeStep;)this.update(t),e=!0,this.accumulated-=this.timeStep;e&&this.render(),this.raf=window.requestAnimationFrame(this.loop)};start(){this.running=!0,this.raf=window.requestAnimationFrame(this.loop)}stop(){this.running=!1,this.raf&&window.cancelAnimationFrame(this.raf)}setUp(t,e){this.update=t,this.render=e}}class R extends y{color;move_force;image;constructor(t,e,s,i,r,a){super(t,e,s,i),this.color=r,this.move_force=Math.random()*1+1,this.image=a}moveUp(){this.moveY(-this.move_force)}render(t){this.image?t.drawImage(this.image,this.x,this.y-25,80,60):(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height))}}class B{activePlatforms;images;constructor(t,e){this.activePlatforms=t,this.images=e.map(s=>{const i=new Image;return i.src=s,i})}createPlatform(t,e){const s=Math.floor(Math.random()*this.images.length),i=this.images[s],r=80,a=4;this.activePlatforms.push(new R(t,e,r,a,"#000",i))}}class F extends y{color;sprite;floatTime;floatAmplitude;floatSpeed;floatPhase;constructor(t,e,s,i,r,a){super(t,e,s,i),this.color=r,this.sprite=a,this.floatTime=Math.random()*Math.PI*2,this.floatAmplitude=3+Math.random()*5,this.floatSpeed=.02+Math.random()*.05,this.floatPhase=Math.random()*Math.PI*2}update(){this.floatTime+=this.floatSpeed,this.sprite&&this.sprite.update()}render(t){const e=Math.sin(this.floatTime+this.floatPhase)*this.floatAmplitude;this.sprite?this.sprite.render(t,this.x,this.y+e,this.width,this.height):(t.fillStyle=this.color,t.fillRect(this.x,this.y+e,this.width,this.height))}}class X{groundCollision(t,e){return t.getBottom()>=e}platformCollision(t,e){const s=t.getRight()>e.getLeft()&&t.getLeft()<e.getRight(),i=t.getBottom()>e.getTop()&&t.getOldBottom()<=e.getOldTop();return s&&i}itemCollision(t,e){const s=t.getRight()>e.getLeft()&&t.getLeft()<e.getRight(),i=t.getBottom()>e.getTop()&&t.getTop()<e.getBottom();return s&&i}}class k{activeItems;sprites;constructor(t,e){this.activeItems=t,this.sprites=e}createItem(t,e,s,i){const r=this.sprites[i];this.activeItems.push(new F(t,e,16,16,s,r))}}class D{value;flashes;counterX;counterY;constructor(){this.value=0,this.flashes=[],this.counterX=80,this.counterY=40}add(t,e,s){e!==void 0&&s!==void 0&&this.flashes.push({text:`+${t}`,x:e,y:s,startX:e,startY:s,targetX:this.counterX+10,targetY:this.counterY-8,timer:30,points:t,merged:!1,scale:2,color:"yellow",alpha:1})}update(){for(const e of this.flashes)if(e.merged)e.timer--,e.alpha=e.timer/15;else{const s=(e.targetX-e.x)*.2,i=(e.targetY-e.y)*.2;e.x+=s,e.y+=i,e.scale=1+.5*Math.hypot(e.targetX-e.x,e.targetY-e.y)/100;const r=Math.hypot(e.targetX-e.x,e.targetY-e.y);e.alpha=Math.min(1,r/100),Math.abs(e.x-e.targetX)<2&&Math.abs(e.y-e.targetY)<2&&(e.merged=!0,e.timer=15,e.x=e.targetX,e.y=e.targetY,e.scale=1,e.color="white",e.alpha=1)}this.flashes.filter(e=>e.merged&&e.timer<=0).forEach(e=>this.value+=e.points),this.flashes=this.flashes.filter(e=>!e.merged||e.timer>0)}render(t){t.fillStyle="#fff",t.font="20px Arial",t.fillText("Score:",this.counterX-60,this.counterY-10),t.fillStyle="#fff",t.font="22px Arial",t.fillText(`${this.value}`,this.counterX+10,this.counterY-8);for(const e of this.flashes)t.fillStyle=`rgba(255,255,0,${e.alpha})`,t.font=`${22*e.scale}px Arial`,t.fillText(e.text,e.x,e.y)}}class G extends y{color;image;constructor(t,e,s,i,r){super(t,e,s,i),this.color=r,this.image=new Image,this.image.src="assets/ground-stay-down.png"}render(t){this.image?t.drawImage(this.image,this.x,this.y,this.width,this.height):(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height))}}class C extends y{color;image;floatTime;floatAmplitude;floatSpeed;floatPhase;rotation;rotationSpeed;constructor(t,e,s,i,r){super(t,e,s,i),this.color=r,this.image=new Image,this.image.src="assets/blade-stay-down.png",this.floatTime=Math.random()*Math.PI*2,this.floatAmplitude=3+Math.random()*5,this.floatSpeed=.02+Math.random()*.05,this.floatPhase=Math.random()*Math.PI*2,this.rotation=Math.random()*2*Math.PI,this.rotationSpeed=.05+Math.random()*.1}update(){this.floatTime+=this.floatSpeed,this.rotation+=this.rotationSpeed,this.rotation%=2*Math.PI}render(t){const e=Math.sin(this.floatTime+this.floatPhase)*this.floatAmplitude,s=this.x+this.width/2,i=this.y+e+this.height/2;t.save(),t.translate(s,i),t.rotate(this.rotation),this.image?t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height):(t.fillStyle=this.color,t.fillRect(-this.width/2,-this.height/2,this.width,this.height)),t.restore()}}class U{activeBlades;constructor(t){this.activeBlades=t}createBlade(t,e,s){this.activeBlades.push(new C(t,e,48,48,s))}}class z{player;controller;ctx;platformManager;bladesManager;collisions;itemManager;score;ground;letters=[];lettersInitialized=!1;isGameOver=!1;constructor(t,e,s,i,r,a,l,c){this.player=e,this.controller=t,this.ctx=s,this.platformManager=i,this.collisions=r,this.itemManager=a,this.score=l,this.bladesManager=c,this.ground=new G(0,f.top,n,50,"#000")}update(){if(this.isGameOver){if(this.controller.start&&this.lettersInitialized){for(let t of this.letters)t.exit=!0,t.vx=(Math.random()-.5)*15,t.vy=(Math.random()-.5)*15;this.lettersInitialized=!1}this.letters.length>0&&this.letters.every(t=>t.exit&&(t.x<-100||t.x>n+100||t.y<-100||t.y>o+100))&&this.restart();return}if(this.checkGameEnd(this.player),this.controller.left&&this.player.moveLeft(),this.controller.right&&this.player.moveRight(),this.controller.up&&this.player.jump(),this.controller.down){const t=this.player.velocity_x>=0?1:-1;this.player.slide(t)}this.player.updatePosition(_,T),this.score.update(),this.collisions.groundCollision(this.player,f.top)&&(this.player.setBottom(f.top),this.player.ground()),this.updatePlatforms(),this.updateItems(),this.updateBlades()}render(){this.ctx.fillStyle="#838282ff",this.ctx.fillRect(0,0,n,o);const t=this.platformManager.activePlatforms;for(let i=t.length-1;i>=0;--i)t[i].render(this.ctx);const e=this.itemManager.activeItems;for(let i=e.length-1;i>=0;--i)e[i].render(this.ctx);const s=this.bladesManager.activeBlades;for(let i=s.length-1;i>=0;--i)s[i].render(this.ctx);this.ground.render(this.ctx),!this.isGameOver&&!this.controller.pause&&this.player.render(this.ctx),this.score.render(this.ctx),this.isGameOver&&(this.ctx.fillStyle="rgba(0,0,0,0.6)",this.ctx.fillRect(0,0,n,o),this.renderLetters())}checkGameEnd(t){t.getTop()<4&&(t.y=t.old_y=f.top-t.height,t.x=0,this.score.value=0,this.isGameOver=!0,this.controller.getGameOver(!0),this.lettersInitialized||this.initLettersAnim("GAME OVER"))}initLettersAnim(t){this.letters=[];const e=32;this.ctx.font=`${e}px Arial`;const s=this.ctx.measureText(t).width,i=(n-s)/2,r=o/2;for(let a=0;a<t.length;a++){const l=t[a],c=i+this.ctx.measureText(t.substring(0,a)).width,m=r;let d,u;const w=Math.floor(Math.random()*4);w===0?(d=-100,u=Math.random()*o):w===1?(d=n+100,u=Math.random()*o):w===2?(d=Math.random()*n,u=-100):(d=Math.random()*n,u=o+100);const v=c-d,x=m-u,M=Math.sqrt(v*v+x*x),I=v/M*12,P=x/M*12;this.letters.push({char:l,targetX:c,targetY:m,x:d,y:u,vx:I,vy:P,arrived:!1,exit:!1})}this.lettersInitialized=!0}renderLetters(){this.ctx.fillStyle="white",this.ctx.font="32px Arial",this.ctx.textBaseline="top";for(let t of this.letters){if(!t.arrived&&!t.exit){const e=t.targetX-t.x,s=t.targetY-t.y;Math.abs(e)<6&&Math.abs(s)<6?(t.arrived=!0,t.x=t.targetX,t.y=t.targetY):(t.x+=t.vx,t.y+=t.vy)}else t.exit&&(t.x+=t.vx*2,t.y+=t.vy*2);this.ctx.fillText(t.char,t.x,t.y)}}restart(){this.isGameOver=!1,this.letters=[],this.lettersInitialized=!1,this.player.y=f.top-this.player.height,this.player.x=0,this.player.velocity_x=0,this.player.velocity_y=0,this.controller.start=!1,this.controller.getGameOver(!1),this.score.value=0,this.createPlatforms(),this.createItems(),this.createBlades()}updatePlatforms(){const t=this.platformManager.activePlatforms;for(let e=t.length-1;e>=0;--e){const s=t[e];this.collisions.platformCollision(this.player,s)&&(this.player.setBottom(s.getTop()),this.player.ground()),s.moveUp(),s.y<32&&(s.y=o,s.move_force=Math.random()*1+1)}}updateItems(){const t=this.itemManager.activeItems;for(let e=t.length-1;e>=0;--e){const s=t[e];this.collisions.itemCollision(this.player,s)?(this.score.add(1,s.x,s.y),s.setLeft(Math.random()*(n-s.width)),s.setTop(Math.random()*(o-s.height-(o-f.top)))):s.update()}}updateBlades(){const t=this.bladesManager.activeBlades;for(let e=t.length-1;e>=0;--e)t[e].update()}createItems(){this.itemManager.activeItems=[];for(let t=0;t<4;t++)this.itemManager.createItem(100,Math.random()*(o-16-(o-f.top)),"green",t)}createBlades(){this.bladesManager.activeBlades=[];for(let t=0;t<10;t++)this.bladesManager.createBlade(t*48,-12,"green")}createPlatforms(){this.platformManager.activePlatforms=[];for(let t=n;t>0;t-=24)this.platformManager.createPlatform(t+8,f.top)}}class g{static loadSpriteFrames(t,e,s,i){return new Promise((r,a)=>{const l=new Image;l.src=t,l.onload=()=>{const c=[];for(let m=0;m<i;m++){const d=document.createElement("canvas");d.width=e,d.height=s,d.getContext("2d").drawImage(l,m*e,0,e,s,0,0,e,s),c.push({image:d,width:e,height:s})}r(c)},l.onerror=()=>a(`Failed to load image: ${t}`)})}}class j{canvas;ctx;player;controller;engine;state;platformManager;collisions;itemManager;bladesManager;score;constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{alpha:!0}),this.itemManager=null,this.bladesManager=new U([]),this.controller=new L(!1,!1,!1,!1,!1,!1),this.engine=new Y(()=>this.update(),()=>this.render()),this.platformManager=new B([],["assets/lake-land-stay-down.png","assets/wood-land-stay-down.png","assets/palm-land-stay-down.png"]),this.collisions=new X,this.score=new D,this.controller.activate(),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){const t=window.innerWidth/n,e=window.innerHeight/o;let s=Math.min(t,e);s=Math.min(s,1),this.canvas.width=n,this.canvas.height=o,this.canvas.style.width=`${n*s}px`,this.canvas.style.height=`${o*s}px`}update(){this.controller.pause||!this.state||this.state.update()}render(){this.state&&this.state.render()}async start(){try{const t=await g.loadSpriteFrames("assets/idle-stay-down.png",32,32,3),e=await g.loadSpriteFrames("assets/run-stay-down.png",32,32,3),s=await g.loadSpriteFrames("assets/jump-stay-down.png",32,32,3),i=await g.loadSpriteFrames("assets/slide-stay-down.png",32,32,3),r=await g.loadSpriteFrames("assets/stars-stay-down.png",32,32,3),a=[new p(r,6),new p(r,6),new p(r,6),new p(r,6)];this.itemManager=new k([],a),this.player=new E(O,A,b,S,"red",new p(t,5),new p(e,5),new p(s,5),new p(i,5)),this.state=new z(this.controller,this.player,this.ctx,this.platformManager,this.collisions,this.itemManager,this.score,this.bladesManager),this.state.createPlatforms(),this.state.createItems(),this.state.createBlades(),this.engine.start()}catch(t){console.error(t)}}stop(){this.engine.stop(),this.controller.deactivate()}}document.querySelector("#app").innerHTML=`
  <canvas id="canvas" />
`;const $=document.getElementById("canvas"),H=new j($);H.start();
