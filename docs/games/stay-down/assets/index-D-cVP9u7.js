(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const h=480,n=480,d=1,f=.9,p=32,u=32,m=100,y=100,l={top:n-u};class c{old_y;x;y;width;height;constructor(t,e,s,i){this.old_y=e,this.x=t,this.y=e,this.width=s,this.height=i}getBottom(){return this.y+this.height}getTop(){return this.y}getOldBottom(){return this.old_y+this.height}getOldTop(){return this.old_y}getLeft(){return this.x}getRight(){return this.x+this.width}setBottom(t){this.y=t-this.height}setTop(t){this.y=t}setLeft(t){this.x=t}setRight(t){this.x=t-this.width}moveX(t){this.x+=t}moveY(t){this.old_y=this.y,this.y+=t}}class g extends c{color;velocity_x;velocity_y;move_force;jump_force;grounded;constructor(t,e,s,i,r){super(t,e,s,i),this.color=r,this.velocity_y=0,this.velocity_x=0,this.move_force=1,this.jump_force=16,this.grounded=!1}ground(){this.grounded=!0,this.velocity_y=0}jump(){this.grounded&&(this.grounded=!1,this.velocity_y-=this.jump_force)}moveLeft(){this.velocity_x-=this.move_force}moveRight(){this.velocity_x+=this.move_force}updatePosition(t,e){this.old_y=this.y,this.velocity_y+=t,this.moveY(this.velocity_y),this.x+=this.velocity_x,this.velocity_y*=e,this.velocity_x*=e}}class v{left;right;up;pause;constructor(t,e,s,i){this.left=t,this.right=e,this.up=s,this.pause=i}keyDown=t=>{switch(t.key){case"ArrowLeft":this.left=!0;break;case"ArrowRight":this.right=!0;break;case"ArrowUp":this.up=!0;break;case" ":this.pause=!this.pause;break}};keyUp=t=>{switch(t.key){case"ArrowLeft":this.left=!1;break;case"ArrowRight":this.right=!1;break;case"ArrowUp":this.up=!1;break}};activate(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp)}deactivate(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp)}}class w{update;render;raf;timeStep;accumulated;current;elapsed;running;constructor(t,e){this.update=t,this.render=e,this.timeStep=1e3/60,this.accumulated=0,this.current=0,this.elapsed=0,this.running=!1,this.raf=void 0}loop=t=>{let e=!1;for(this.elapsed=t-this.current,this.accumulated+=this.elapsed,this.current=t,this.accumulated>60&&(this.accumulated=this.timeStep);this.accumulated>=this.timeStep;)this.update(),e=!0,this.accumulated-=this.timeStep;e&&this.render(),this.raf=window.requestAnimationFrame(this.loop)};start(){this.running=!0,this.raf=window.requestAnimationFrame(this.loop)}stop(){this.running=!1,this.raf&&window.cancelAnimationFrame(this.raf)}setUp(t,e){this.update=t,this.render=e}}class _ extends c{color;velocity_x;velocity_y;move_force;grounded;constructor(t,e,s,i,r){super(t,e,s,i),this.color=r,this.velocity_y=0,this.velocity_x=0,this.move_force=Math.random()*1+1,this.grounded=!1}moveUp(){this.moveY(-this.move_force)}}class x{activePlatforms;constructor(t){this.activePlatforms=t}createPlatform(t,e){this.activePlatforms.push(new _(t,e,48,4,"blue"))}}class L{groundCollision(t,e){return t.getBottom()>=e}platformCollision(t,e){return!(t.getRight()<e.getLeft()||t.getLeft()>e.getRight()||t.getBottom()<=e.getTop()||t.getOldBottom()>e.getOldTop())}}class R extends c{color;constructor(t,e,s,i,r){super(t,e,s,i),this.color=r}}class P{activeItems;constructor(t){this.activeItems=t}createItem(t,e,s){this.activeItems.push(new R(t,e,16,16,s))}}class M{player;controller;ctx;platformManager;collisions;itemManager;constructor(t,e,s,i,r,a){this.player=e,this.controller=t,this.ctx=s,this.platformManager=i,this.collisions=r,this.itemManager=a}update(){this.controller.left&&this.player.moveLeft(),this.controller.right&&this.player.moveRight(),this.controller.up&&this.player.jump(),this.player.updatePosition(d,f),this.collisions.groundCollision(this.player,l.top)&&(this.player.setBottom(l.top),this.player.ground());let t=this.platformManager.activePlatforms;for(let e=t.length-1;e>-1;--e){let s=t[e];this.collisions.platformCollision(this.player,s)&&(this.player.setBottom(s.getTop()),this.player.ground()),s.moveUp(),s.y<32&&(s.y=n,s.move_force=Math.random()*1+1)}}render(){this.ctx.fillStyle="#303840",this.ctx.fillRect(0,0,h,n),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,l.top,h,4);let t=this.platformManager.activePlatforms;this.ctx.fillStyle="#0090f0";for(let e=t.length-1;e>-1;--e){let s=t[e];this.ctx.fillRect(s.x,s.y,s.width,s.height)}this.ctx.fillStyle=this.player.color,this.ctx.fillRect(this.player.x,this.player.y,this.player.width,this.player.height)}createPlatforms(){for(let t=h-50;t>0;t-=50)this.platformManager.createPlatform(t,l.top)}}class A{canvas;ctx;player;controller;engine;state;platformManager;collisions;itemManager;constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{alpha:!0}),this.player=new g(m,y,p,u,"red"),this.controller=new v(!1,!1,!1,!1),this.engine=new w(()=>this.update(),()=>this.render()),this.platformManager=new x([]),this.itemManager=new P([]),this.collisions=new L,this.state=new M(this.controller,this.player,this.ctx,this.platformManager,this.collisions,this.itemManager),this.controller.activate(),this.resizeCanvas()}resizeCanvas(){this.canvas.width=h,this.canvas.height=n}update(){this.controller.pause||this.state.update()}render(){this.state.render()}start(){this.engine.start(),this.state.createPlatforms()}stop(){this.engine.stop(),this.controller.deactivate()}}document.querySelector("#app").innerHTML=`
  <canvas id="canvas" />
`;const T=document.getElementById("canvas"),I=new A(T);I.start();
